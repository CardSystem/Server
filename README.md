)## 프로젝트 소개

‘**CardTracker**’ 는 미니 카드사 시스템이다. 유저는 보유한 카드로 결제를 진행할 수 있고 계좌에 잔액을 충전할 수 있다. 시스템 관리자는 여러 데이터를 바탕으로 결제 내역을 조회하고 관리한다. 평소 국민 대부분이 사용하는 카드 시스템을 프로토타입으로 만들어보며 DB 설계와 시스템 구현 등에 대해 고민해보고자 개발하게 되었다.

## 기술스택

개발환경 : <img src="https://cdn.devinflearn.com/public/files/posts/45a25c80-b53e-4631-b9b9-210ff1daeeec/Java-Logo.png" height="50px">
<img src="data:image/jpeg;base64,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" height="50px">

사용한 기술스택 : Redis, maven, JSP, Servlet, CSS, JS, Bootstrap

배포환경 : AWS Route 53, EC2, Certificate Manager, RDS

DB : MySQL

협업 : github
배포환경 : AWS Route 53, EC2, Certificate Manager, RDS

DB : MySQL

협업 : github

## 시스템 아키텍쳐

(그림)

## 기술적 고려 사항

### 동시성 이슈 처리

1. 문제점
    
    한 계좌에 3개의 카드가 연결될 수 있어 각각의 카드로 동시에 결제하는 일이 생길 때 계좌의 잔액을 읽는 과정에서 커밋되지 않은 값을 읽는 Dirty Read가 발생해 데이터 정합성이 깨지는 문제 발생
    
2. 해결 방법 후보
    - DB 쿼리에 for update 문을 추가하여 비관적락 구현하기
    - Redis를 이용해 분산락 구현하기 → **채택 ✅**
3. 자세한 설명
    
    Redisson을 이용해 스핀락 구현. 데이터 정합성 유지
    
    적용 전
    
    적용 후
    
4. 결과
    
    동시성 테스트를 위해 CompletableFuture 라이브러리를 이용해 비동기 이벤트를 발생시킴. 락을 걸기 전에는 스레드가 접근하는 순서에 따라 잔액 차감의 순서가 달라지고 커밋 전 데이터를 읽음으로써 Dirty Read가 일어나고 실제 남아야하는 잔액과 달라지는 케이스가 발생했다.
    
    (사진)
    
    분산락 적용 시에는 데이터의 정합성이 유지되며 계좌 잔액이 올바르게 유지되는 것을 알 수 있다.
    

### DB 설계

1. 외래키 지양 이유
    1. 카드와 계좌를 이용한 결제 시스템은 데이터를 보존하는 것이 중요한 시스템이기 때문에 데이터가 실수로 변경되거나 오염되는 경우 참조되는 모든 릴레이션이 영향받는 것 방지
    2. 카드 시스템은 대규모 시스템으로 확장될 필요가 있는데 fk를 추가 시 데이터를 생성 및 수정시 항상 무결성 검사를 거치기 때문에 insert/update 시 성능 저하 방지
    3.  확장성 및 개발 용이성을 고려
2. 계좌 당 카드갯수 제한 방법
    - 계좌-카드갯수를 저장하는 새로운 테이블 생성
    - 카드를 추가할 때마다 전체 카드 테이블을 COUNT 함수로 조회해 그 값을 기준으로 예외 처리 → **채택 ✅**

### 배포 시 SSL 인증

- SSL 인증을 위해 AWS의 Route 53, Certificate Manager를 사용했다. 도메인은 가비아에서 구매했다.

### BusinessException 처리

- enum으로 ErrorCode를 만들어서 statusCode, statusMessage, message를 관리
- business custom exception을 손쉽게 관리하기 위함

### 유닛테스트 (feat, JUnit5, Mockito)

- Mock 객체를 이용해 레이어 간 결합성을 끊고 DB에 의존하지 않는 순수 Service 로직을 테스트 하고자 했다.
- 실제 운영하는 DB 서버에 문제가 생기더라도 테스트는 성공할 수 있도록 했다.
- 실패 케이스와 성공 케이스를 모두 작성했다. 실패 케이스를 작성한 이유는 위에서 언급했듯이 FK를 연결하지 않았기 때문에 어플리케이션 단에서 꼼꼼하게 예외처리를 해서 무결성을 유지하도록 했는데 실패 시 서버단에서 예외를 잘 처리하는지도 테스트해야하기 때문이다.
